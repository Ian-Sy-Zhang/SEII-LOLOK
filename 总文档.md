# XXX电影管理系统总文档

[TOC]

# 用例文档
## 1. 引言
该系统有两个主要参与角色类型：

1. 影院账户：用于添加、上架电影以及整合相关数据，统计相关电影的热度
2. 用户账户：和系统交互，标记想看的电影，查找相关电影的信息  

在注册的时候，能够注册两种类型的账户：影院管理账户和普通用户账户。

登陆时，识别两种账户的类型，提供和角色相称的服务。

## 2. 用例图

![用例图](https://s2.ax1x.com/2019/03/19/AnT4Ff.png)




## 3. 用例列表
- 影院上架电影
- 统计预售电影想看人数
- 观众查看电影详情
- 标记某电影为想看
- 查找电影



## 4. 详细用例描述

### 4.1 上架电影
- 用例编号：1

- 名称：上架电影                                             

- 创建者：胡煜之

- 创建日期：3月16号

- 最后一次更新者：张士煜

- 更新日期：3月19号

- 参与者 ：影院，目的是发布新上映的电影的信息 

- 触发条件：影院需要上架新的电影

- 前置条件：

  1. 系统处于影院账号的登陆状态

- 后置条件：存储电影信息，并向所有观众公示（发布）

- 优先级：中

- 正常流程：

  1. 确认登陆状态
  2. 填写相关电影信息
  3. 发布相关信息

- 扩展流程：

    1a.登陆状态异常

- 特殊需求：

  1. 电影信息模块清晰完整美观  

### 4.2 统计预售电影的想看人数 

- 用例编号：2

- 名称：统计预售电影的想看人数                                            

- 创建者：曹阳

- 创建日期：3月16号

- 最后一次更新者：张士煜

- 更新日期：3月19号

- 参与者 ：影院，目的是调查电影的热度 

- 触发条件：影院需要了解电影的受欢迎清苦那个

- 前置条件：

  1. 系统处于影院账号的登陆状态

- 后置条件：无

- 优先级：中

- 正常流程：

  1. 影院选择需要查询的电影  
  2. 系统访问数据库计算得到想看电影的人数

- 扩展流程：

    1a.电影不存在或者未上架  

         2.系统提示错误并拒绝查询

- 特殊需求：无  

### 4.3 查看电影信息

- 用例编号：3

- 名称：查看电影信息                                             

- 创建者：康南

- 创建日期：3月16号

- 最后一次更新者：张士煜

- 更新日期：3月19号

- 参与者 ：观众：想要获取电影信息

- 触发条件：影院需要上架新的电影

- 前置条件：

  1. 系统处于观众账号的登陆状态

- 后置条件：无

- 优先级：中

- 正常流程：

  1. 确认登陆状态
  2. 查看影院提供的电影信息

- 扩展流程：

    1a.登陆状态异常

- 特殊需求：

  1. 排版清晰，系统能够直观的提供观众想要获取的信息

### 4.4 标记某电影为想看

- 用例编号：4

- 名称：标记某电影为想看                                             

- 创建者：曹阳

- 创建日期：3月16号

- 最后一次更新者：张士煜

- 更新日期：3月19号

- 参与者 ：观众：顺利表达自己对电影的“想看”

- 触发条件：观众想要表达自己对电影的“想看”

- 前置条件：

  1. 系统处于观众账号的登陆状态

- 后置条件：记录电影是否为“想看”状态，并更新数据库中的统计数据

- 优先级：低

- 正常流程：

  1. 用户点击“想看”标记

- 扩展流程：

    1a.如果该电影已经被标记为“想看”  

        2.进行提示并取消“想看”标记

- 特殊需求：

  1. 便于辨识该电影是否已经被标记为“想看”  
  2. 交互体验直观、方便

### 4.5 搜索电影

- 用例编号：5

- 名称：搜索电影                                             

- 创建者：张士煜

- 创建日期：3月16号

- 最后一次更新者：张士煜

- 更新日期：3月19号

- 参与者 ：观众，目的是了解某电影的相关信息

- 触发条件：观众想要了解某电影的相关信息

- 前置条件：

  1. 系统处于观众账号的登陆状态

- 后置条件：存储电影信息，并向所有观众公示（发布）

- 优先级：中

- 正常流程：

  1. 输入想要查找的电影的相关信息（日期、名称等）
  2. 系统创文数据库，返回相关信息

- 扩展流程：

    2a.未查找到符合条件的电影

        2.系统提示错误并结束查找

- 特殊需求：无





## 5. 需求分析模型 
### 5.1 系统顺序图

#### 5.1.1  上架电影

![用例1](https://s2.ax1x.com/2019/03/19/AnT6QH.png) 

#### 5.1.2  统计预售电影想看人数

![用例2](https://s2.ax1x.com/2019/03/19/AnTgOA.md.png)

#### 5.1.3  查看电影信息

![用例3](https://s2.ax1x.com/2019/03/19/AnTfTP.png)

#### 5.1.4  标记某电影为想看

![用例4](https://s2.ax1x.com/2019/03/19/AnTWwt.png)

#### 5.1.5  搜索电影

![用例5](https://s2.ax1x.com/2019/03/19/AnTReI.md.png)



### 5.2 概念类图

#### 5.2.0  全局概念类图 

![全局概念类图](https://s2.ax1x.com/2019/03/19/AnTySe.md.png)

#### 5.2.1   影院上架电影

![概念类图1](https://s2.ax1x.com/2019/03/19/AnTcyd.md.png)

#### 5.2.2   统计预售电影想看人数

![概念类图2](https://s2.ax1x.com/2019/03/19/AnTddx.png)

#### 5.2.3  查看电影信息

![概念类图3](https://s2.ax1x.com/2019/03/19/AnTwo6.png)

#### 5.2.4  标记电影为“想看”

![概念类图4](https://s2.ax1x.com/2019/03/19/AnTrWD.png)

#### 5.2.5  查找电影

![概念类图5](https://s2.ax1x.com/2019/03/19/AnTDJO.png)  





### 5.3 状态图  

#### 5.3.0  全局状态图

![全局状态图](https://s2.ax1x.com/2019/03/19/AnTBFK.png)

#### 5.3.1  标记某电影为想看

![标记某电影为想看](https://s2.ax1x.com/2019/03/19/AuyfS0.png)

#### 5.3.2  查看电影详情

![查看电影详情](https://s2.ax1x.com/2019/03/19/AuygFs.png)

#### 5.3.3  上架电影

![上架电影](https://s2.ax1x.com/2019/03/19/AuyhlV.png)

#### 5.3.4  搜索电影

![搜索电影](https://s2.ax1x.com/2019/03/19/Auy2Yn.png)

#### 5.3.5  统计预售电影想看人数

![统计预售电影想看人数](https://s2.ax1x.com/2019/03/19/AuyRWq.png)





















































# XXX影院需求说明规格文档 

1.引言

​	1.1目的

​	1.2范围

​	1.2参考文献

2.总体描述

​	2.1商品前景

​	2.2商品功能

​	2.3用户特征

​	2.4约束

​	2.5假设和依赖

3.详细需求描述

​	3.1对外接口需求

​	3.2功能需求

​	3.3非功能需求

​	3.4数据需求

​	3.5其他需求

4.附录

## 1. 引言

### 1.1 目的

​	本文档描述了电影管理系统SEII-LOLOK的功能需求与非功能需求。开发小组的软件系统实现与验证工作都以此文档为依据。

​	除特殊说明外，本文档所包括的需求都是高优先级需求。

### 1.2 范围

​	电影管理系统SEII-LOLOK是为XXX影院开发的业务系统，开发目标是帮助该影院处理日常的重点任务以及帮助观众更好的了解电影，包括上架电影、统计想看某电影的观众人数、查找电影、查看电影详情、将某电影标记为想看。

​	通过电影管理系统SEII-LOLOK的应用，期望为XXX影院提高工作效率、合理安排影片场次、吸引观众并提高满意度、提高销售额和利润。

### 1.3 参考文献

​	1）IEEE 标准

​	2）电影管理系统SEII-LOLOK用例文档 V1.0。  

## 2. 总体描述

### 2.1 商品前景

#### 2.1.1 背景与机遇

​	XXX影院是一家有着拓展业务需求的电影院。原影院只有售票部分使用软件处理，其他业务都是手工作业，这已经不能适应它的业务发展需求。首先是影院规模扩大，顾客量大幅增长，手工作业拍片缺乏合理性，不能根据观众的意愿调整场次。其次是观众难以获得新上映电影的信息，无法吸引潜在的观众。希望在吸引顾客、增强竞争力的同时，保持盈利水平。

​	电影管理系统SEII-LOLOK就是为XXX影院新的业务需求发展要求而开发的，它包括一个数据集中服务器和多个客户端。数据集中服务器将所有的数据存储起来进行维护。用户通过客户端完成日常操作，客户端与数据集中服务器才是实时通信的方式完成数据交换。

#### 2.1.2 业务需求

​	BR1: 系统使用后，超过60%的场次上座率要超过75%。

​	BR2: 系统使用2个月后，销售额要提高50%。

​	BR3: 系统使用3个月后，平均每日顾客数要提高30%。

​		最好情况：50%

​		最可能情况：30%

​		最坏情况：10%

### 2.2 商品功能

​	SF1: 影院上架电影，为顾客提供电影信息。

​	SF2: 向顾客提供查找电影的服务。

​	SF3: 向顾客提供查看电影详情的服务。

​	SF4: 允许顾客对想看的电影进行标记。

​	SF5: 统计想看电影的标记，为拍片决策提供数据。

### 2.3 用户特征

| 用户         | 用户特征                                                     |
| ------------ | ------------------------------------------------------------ |
| 影院工作人员 | 仅有1家影院有一个工作人员，他每天都会完成一些任务，在新电影发布时进行上架和统计想看人数的工作，工作量并不大。该系统是向观众发布电影信息，统计电影受欢迎程度的主要方法，所以该工作人员对本软件系统的依赖很大。影院工作人员的计算机操作技能一般，既无法快速熟练的使用鼠标的定位和拖拽等功能，也无法以盲打整个键盘的方式工作。尤其对于新上手使用这个系统的工作人员，他会因为业务不熟练而出现错误或不知所措，希望新系统尽可能帮他们解决这些问题。 |
| 顾客         | 顾客的数量将会非常多，他们会随机的访问该系统，进行一些操作。因为这是了解影院电影信息，并表达想看某电影欲望的最有效途径，所以他们对软件系统的依赖很大。顾客的计算机操作水平存在较大的差距，有些顾客无法熟练的使用计算机。甚至一些顾客可能会对计算机操作感到不知所措希望新系统尽可能帮他们解决这些问题。 |

### 2.4 约束

​	CON1: 系统将运行在Windows 7操作系统上。

​	CON2: 系统使用Web界面。

​	CON3: 项目要使用持续集成方法进行开发。

​	CON4: 在开发中，开发者要提交软件需求规格说明文档、设计描述文档和测试报告。

### 2.5 假设和依赖

​	AE1: 影院同时上架电影不超过10部。

​	AE2: 电影上架后，30日后将会下架。  



## 3.详细需求描述  

### 3.1对外接口需求  

#### 3.1.1用户界面  

***管理员账号登陆后，屏幕左侧显示管理员操作列表，屏幕右上角为当前用户登陆状态，点击出现退出登录、切换账号菜单。***

UI 1 上架电影：管理员点击屏幕左侧的“上架电影”按钮，进入“上架电影”页面

​	UI 1.1 页面顶端为一系列重要的必填选项（片名、上映日期、上传封面图），下方为一个文本框，用于输入 	摘要信息。最下方有“提交”按钮

​		UI 1.1.1 若15min没有响应，则页面弹出“未响应”状态框，不做任何保存，单击弹框中的“确定”返回首		页。

​		UI 1.1.2 若文本框输入了非文本内容，单击”提交“后弹出”输入内容不合法“弹窗，不保存数据。

​	UI 1.2 弹出”提交成功“弹窗，单击弹窗中的”确定“返回账户首页   

UI 2 影院统计电影想看人数：管理人员选择“统计电影想看人数”操作，进入”筛选电影“页面

​	UI 2.1 筛选电影页面上方为一个条件筛选框（名称、上映日期区间），下方紧贴着一个搜索框。页面中部为	一个大的返回列表，列表的上方有一栏排序设置。

​	UI 2.2 显示复合筛选条件的电影，点击排序设置，弹框弹出“按照上映日期排序”、“按照想看人数排序”、“按照	上映时长排序”。

​		UI 2.2.1选择排序方式显示排序后的电影列表  



***用户账号登陆后直接显示“筛选电影”页面，屏幕右上角为当前用户登陆状态，点击出现退出登录、切换账号菜单。***

UI 3 用户点击筛选电影后显示符合条件的电影列表，用户可以点击电影的海报进入详细电影信息页面。页面中间为电影的信息，最下方为“想看人数”，标示若该用户想看该电影，则“想看”图标为红色。左上方为一个返回箭头。

​	UI 3.1 用户点击“想看人数”标示；若该用户本来没有将本电影标为想看，则“想看”标示变为红色；若该用户本	来就将该电影标记为“想看”，则将“想看”电影变回原来的颜色。

​	UI 3.2 用户点击返回箭头，界面返回电影列表

UI 4 用户点击搜索框，输入电影相关信息进行搜索

​	UI 4.1 用户输入无效（字符串乱码）的搜索信息并搜索，界面弹出弹框“搜索信息无效”

​	UI 4.2 用户点击搜索后，显示电影列表页面

​		UI 4.2.1 若无符合条件的电影，弹出弹框“无符合条件的电影”

#### 3.1.2通信接口  

CI：客户端和服务器使用RMI的方式进行通信





### 3.2 功能需求

#### 3.2.1 影院上架电影

##### 3.2.1.1 特性描述

在影院想要在系统上登记新上映的电影时，影院的管理人员登陆影院账户，完成填写电影信息，确认上架，片库更新

优先级 = 高

##### 3.2.1.2刺激/响应序列

刺激：管理人员选择上架电影操作。

响应：系统显示填写上架电影信息界面并提示填写电影信息。

刺激：管理人员取消上架电影。

响应：系统关闭上架任务。

刺激：管理人员删除已输入信息。

响应：系统删除该信息。

刺激：管理人员提交输入的上架电影的信息。

响应：系统储存电影信息，更新片库，显示上架成功。

##### 3.2.1.3相关功能需求

| Upload.Input         | 系统允许管理员在上架电影过程中进行输入                       |
| -------------------- | ------------------------------------------------------------ |
| Upload.Input.Film    | 在收到上架电影操作时，系统执行输入上架电影信息操作,参见Upload.Film |
| Upload.Input.Cancel  | 管理人员选择取消上架任务，系统关闭当前上架任务               |
| Upload.Input.Del     | 在收到管理员删除已输入电影信息时，执行删除操作               |
| Upload.Film.Start    | 在管理人员选择上架电影时，系统要允许管理人员输入电影相关信息 |
| Upload.Film.Valid    | 在管理人员输入相关电影信息后，再次显示电影信息并提醒确认     |
| Upload.Film.Invalid  | 在管理人员输入非文字内容时，系统提示输入无效                 |
| Upload.Film.End      | 管理人员完成电影信息输入点击提交，系统开始结束上架的任务，参见Upload.end |
| Upload.Update        | 系统更新数据库数据                                           |
| Upload.Update.Film   | 系统更新上架电影信息                                         |
| Upload.Update.Cinema | 系统更新影院信息                                             |
| Upload.End           | 系统允许管理员结束上架电影                                   |
| Upload.End.Timeout   | 开始上映15min内管理员无任何操作，系统自动结束上映，不做保存  |
| Upload.End.Update    | 管理人员确认上映影片信息后，结束上架并更新片库数据，参见Upload.Update |
| Upload.End.Close     | 管理人员确认任务完成时，系统关闭上架任务                     |

#### 3.2.2 影院统计电影想看人数

##### 3.2.2.1 特性描述  

在影院想要在统计上映电影的想看人数时，影院的管理人员登陆影院账户，完成筛选电影想看人数数据，排列电影想看人数的列表，统计想看人数的数据。

优先级 = 高

##### 3.2.2.2刺激/响应序列

刺激：管理人员选择“统计电影想看人数”操作。

响应：系统显示最近上架电影想看人数的列表。

刺激：管理人员输入筛选电影的条件（名称、上映日期）。

响应：系统按照筛选电影的条件筛选显示的符合条件的电影的想看人数的列表。

刺激：管理人员选择排序方式。

响应：系统调整列表顺序，按照管理人员选择的排序方式升/降序排序。

刺激：管理人员选择返回。

响应：系统返回主界面

##### 3.2.2.3相关功能需求

| Count.Input               | 系统允许管理员在统计电影想看人数过程中进行输入               |
| ------------------------- | ------------------------------------------------------------ |
| Count.Input.Statistic     | 管理员确认开始统计，系统开始统计，参见Count.Statistic        |
| Count.Input.Cancel        | 管理人员选择取消统计任务，系统关闭当前统计任务               |
| Count.Input.Invalid       | 收到管理员无关操作时，提示操作无效                           |
| Count,Statistic.Start     | 显示最近10部上架电影的先看人数列表                           |
| Count.Statistic.Filter    | 管理员请求筛选电影,系统按照筛选信息来确定需要显示想看人数的电影，参见Count.Filter |
| Count.Statistic.Sequence  | 管理员请求对数据排序，系统执行排序排序任务，参见Count.Sequence |
| Count.Statistic.End       | 系统完成统计工作后，管理员可以请求结束统计任务，系统执行结束统计任务处理，参见，Count.End |
| Count.Sequence.Null       | 需要排序的数据为空，系统不予响应                             |
| Count.Sequence.Amount     | 管理人员选择按照想看人数来排序，系统执行排序任务             |
| Count.Sequence.UploadTime | 管理人员选择按照上映时间来排序，系统执行排序任务             |
| Count.Sequence.RunTime    | 管理人员选择按照上映时长来排序，系统执行排序任务             |
| Count.Filter              | 系统允许管理人员筛选一部分电影参与统计                       |
| Count.Filter.Date         | 管理人员选择筛选规定时间上映的电影，系统执行筛选任务         |
| Count.Filter.Name         | 管理人员选择按照电影名称筛选电影，系统执行筛选任务           |
| Count.Filter.RunTime      | 管理人员选择按照上映时长筛选电影，系统执行筛选任务           |
| Count.Filter.Null         | 根据筛选条件筛选不到任何电影，提示错误                       |
| Count.End                 | 系统应该允许管理员结束统计任务                               |
| Count.End.Timeout         | 开始上映15min内管理员无任何操作，系统自动关闭统计任务        |
| Count.End.Close           | 管理人员确认任务完成时，系统关闭统计任务                     |

#### 3.2.3  查看电影详情

##### 3.2.3.1 特性描述

当观众想要了解某部电影的具体情况时，登陆账户，选取打开该电影界面，查看电影情况

优先级=中

##### 3.2.3.2 刺激/响应序列

刺激：观众选择该电影的海报图标

响应：系统显示该电影的相关信息，包括名称、类别、时长、导演、演员、上架日期、想看人数

刺激：观众退出查看

响应：系统返回电影列表

##### 3.2.3.3 相关功能需求

| View.Film      | 系统显示电影信息，包括名称、类别、时长、导演、演员、上架日期、想看人数 |
| -------------- | ------------------------------------------------------------ |
| View.Film.Null | 该电影尚未上架，系统提示错误并无法查看                       |
| View.End       | 系统允许观众结束查看任务                                     |
| View.End.Close | 观众确认任务结束，系统关闭查看                               |

#### 3.2.4  标记某电影为想看

##### 3.2.4.1 特性描述

当观众想要表达对某部电影的兴趣，确认登陆状态，在电影详情界面完成想看操作

##### 3.2.4.2 刺激/响应序列

刺激：观众确认"想看”

响应：系统记录该电影想看人数+1，将该电影添加到观众的想看列表

刺激：观众取消"想看"

响应：系统记录该电影想看人数-1，将该电影从观众的想看列表中移除

##### 3.2.4.3 相关功能需求

| Like.Add              | 系统允许观众进行"想看"操作                                 |
| --------------------- | ---------------------------------------------------------- |
| Like.Add.Valid        | 观众添加想看，系统记录该电影想看人数+1                     |
| Like.Add.Valid.List   | 观众添加想看，系统将该电影添加到观众的想看列表             |
| Like.Add.Valid.Change | 观众添加想看，系统将界面上的"想看”操作切换成“取消想看”操作 |
| Like.Del              | 系统允许观众进行"取消想看"操作                             |
| Like.Del.Valid        | 观众取消想看，系统记录该电影想看人数-1                     |
| Like.Del.Valid.List   | 观众取消想看，系统将该电影从观众的想看列表移除             |
| Like.Del.Valid.Change | 观众取消想看，系统将界面上的"取消想看"操作切换成"想看"操作 |

#### 3.2.5  搜索电影（日期，名称等）

##### 3.2.5.1 特性描述

观众想要搜索某部电影，登陆自己的账户，在搜索栏输入该电影的关键信息（名称、类别、时长、导演、演员、上架日期），得到搜索结果

优先级=中

##### 3.2.5.2 刺激/响应序列

刺激：观众输入搜索电影的关键信息（名称、类别、时长、导演、演员、上架日期）

响应：系统返回符合条件的电影列表

刺激：观众输入了无效的搜索信息

响应：系统提示搜索信息无效

刺激：观众取消输入

响应：系统结束输入操作，返回主界面

##### 3.2.5.3 相关功能需求

| Search.Input         | 系统允许观众在搜索任务中进行键盘输入                     |
| -------------------- | -------------------------------------------------------- |
| Search.Input.Film    | 观众输入搜索电影的关键信息，具体见Search.Film            |
| Search.Input.Cancel  | 观众取消搜索电影，系统结束操作                           |
| Search.Input.Invalid | 观众输入的信息非法，系统提示输入无效                     |
| Search.Film.Start    | 观众选择搜索电影操作，系统允许观众输入信息               |
| Search.Film.Invalid  | 观众输入其他输入时，系统提示输入无效                     |
| Search.Film.End      | 观众完成输入操作后，系统执行结束输入操作处理             |
| Search.Show          | 系统将搜索到的符合条件的电影以列表形式显示               |
| Search.Show.Invalid  | 系统提示无法找到符合条件的电影                           |
| Search.Del.None      | 观众未输入信息就输入删除已输入信息的命令时，系统不予响应 |
| Search.Del.Valid     | 观众在搜索栏选择要删除的信息，系统删除该信息             |
| Search.End           | 系统允许观众要求结束搜索任务                             |
| Search.End.Close     | 观众确认搜索结束，系统关闭搜索任务                       |

#### 3.2.6 用户退票

##### 3.2.6.1 特性描述

用户在消费记录的订单中选择需要退票的场次，进行退票操作

##### 3.2.6.2 刺激响应序列

刺激：用户想要查找需要退票的订单

响应：系统返回消费订单

刺激：用户选择需要退票的订单

响应：系统进入退票界面

刺激：用户确认退票

响应：系统完成退票

##### 3.2.6.3 相关功能需求
| Refund.Input           | 允许用户在退票时输入                                       |
| ---------------------- | ---------------------------------------------------------- |
| Refund.Input.Cancel    | 用户取消退票                                               |
| Refund.Input.Order     | 用户请求开始退票，系统显示退票信息，参见Refend.Order       |
| Refund.Order           | 用户显示订单信息                                           |
| Refund.Order.Calculate | 系统根据退票策略计算退票金额                               |
| Refund.Order.Refund    | 系统执行退票操作，将数额退还到用户账户                     |
| Refund.Order.End       | 系统完成退票人物，顾客可以请求结束退票任务，参见Refund.End |
| Refund.End             | 在退票结束后用户可以请求结束退票                           |
| Refund.End.upate       | 系统更新数据                                               |
| Refund.End.Close       | 客户确认退票完成，系统关闭退票任务                         |

#### 3.2.6 修改制定退票策略

##### 3.2.6.1 特性描述

系统管理员可以更改退票策略与适用的场次

##### 3.2.6.2 刺激/响应序列

刺激：管理员请求更改退票策略

响应：显示修改界面

刺激：管理员输入新的退票策略

响应：系统显示新的退票策略

刺激：管理员确认结束修改制定退票策略

响应：系统更新数据，显示结束修改

##### 3.2.6.3 相关功能需求

| RefundPolicy.Input         | 系统允许管理员在修改退票策略是输入                           |
| -------------------------- | ------------------------------------------------------------ |
| RefundPolicy.Input.Amend   | 再管理员输入要求修改退票策略时，系统提示输入新的退票策略.参见RefundPolicy.Amend |
| RefundPolicy.Input.Cancel  | 管理员请求取消修改，系统关闭当前任务                         |
| RefundPolicy.Amend         | 系统显示修改界面                                             |
| RefundPolicy.Amend.Input   | 管理员输入要修改的退票策略信息                               |
| RefundPolicy.Amend.Confirm | 管理员确认修改信息                                           |
| RefundPolicy.Amend.End     | 系统完成修改任务进入结束阶段，参见RefundPolicy.End           |
| RefundPolicy.End           | 系统允许管理员结束修改任务                                   |
| RefundPolicy.End.Update    | 系统更新数据                                                 |
| RefundPolicy.Close         | 管理员确认修改完成，系统关闭修改制定退票策略任务             |



### 3.3非功能需求  

#### 3.3.1安全性  

Safety1: 系统应该能正确分辨管理员账户和用户账户，按照用户的身份验证用户的访问权限

Safety2: 系统应该只允许经过注册的用户访问

Safety3: 系统应该要能识别来自同一IP的多次频繁重复访问，视为攻击，暂时屏蔽访问权限。

#### 3.3.2可维护性  

Modifiability1: 系统增加新的功能要在0.3个人月之内完成  

Modifiability2: 系统添加新角色、管理角色要在0.1个人月之内完成  

Modifiability3: 系统能在未清理的情况下容纳至少5000条电影信息

#### 3.3.3 易用性  

Usability1: 用户在登录系统20秒以内搜索到自己想要的电影信息（如果电影存在于数据库之中）

#### 3.3.4 可靠性  

Reliability1: 系统在掉线之后等待10秒钟之后自动重新连接

​	Reliability1.1: 系统若重新连接成功则继续之前的工作

​	Reliability1.2: 若连接失败则提示用户

#### 3.3.5 业务规则  

BR1: 使用系统达到一定年限之后，系统会根据客户的喜好电影自动发送相关电影的购票优惠链接

#### 3.3.6 约束  

IC1: 系统要在网络上分布为一个服务器和多个客户端。  



### 3.4数据需求  

#### 3.4.1  数据定义  

DR1: 系统要存储至少最近半年内，最多5000条电影信息

DR2: 系统要能正确存储用户对于想看的电影，以及每个电影想看的具体人数  

#### 3.4.2 默认数据  

默认数据应用于以下两种情况：  

- 系统添加新数据的时候  
- 编辑数据时不小心将内容清空  

Default1: 电影的默认介绍为“无”

Default2: 电影的默认想看人数为0

Default3: 电影上映的日期被不小心清除之后，默认为上架日期。

#### 3.4.3 数据格式要求  

Format1: 日期的格式必须是 yyyy-mm-dd  

Format2: 简介的默认字符串编码是UTF-8  

Format3: 海报的图片格式为jpg或者png





### 3.5其他需求  

最好使用chrome浏览器。 

















































# 软件体系结构文档

## 文档修改历史

| 修改人员 | 日期    | 修改原因       | 版本号 |
| :------: | ------- | -------------- | ------ |
|  张士煜  | 4月19日 | 整合分配的内容 | 1.0.0  |
|          |         |                |        |



## 1. 引言

### 1.1 编制目的

本报告详细完成对电影院电影管理系统的概要设计，达到指导详细设计与开发的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义       | 备注 |
| -------- | -------------- | ---- |
| CMS      | 电影院管理系统 | ……   |
| ……       | ……             | ……   |

### 1.3 参考资料

1.IEEE标准
2.需求文档0418
3.\*\*\*影院需求规格说明文档

## 2. 产品概述

​	\*\*\*影院是一家有着拓展业务需求的电影院。原影院只有售票部分使用软件处理，其他业务都是手工作业，由于影院规模扩大，顾客量大幅增长等原因，这已经不能适应它的业务发展需求。
电影管理系统SEII-LOLOK就是为\*\*\*影院新的业务需求发展要求而开发的，它包括一个数据集中服务器和多个客户端。数据集中服务器将所有的数据存储起来进行维护。用户通过客户端完成日常操作，客户端与数据集中服务器才是实时通信的方式完成数据交换,开发目标是帮助该影院处理日常的重点任务以及更好的服务观众
​	其主要功能为：
​	帮助影院上架、修改、下架电影，统计电影热度信息，添加、查看、修改排片信息，设置、修改、删除排片信息的观众可见时间，查看统计数据，发布优惠活动。
​	帮助观众搜索、查找电影，标记电影为想看，查看电影列表、电影详情，购买电影票，购买、查看、充值会员卡。
​	通过电影管理系统SEII-LOLOK的应用，期望为\*\*\*影院提高工作效率、合理安排影片场次、吸引观众并提高满意度、提高销售额和利润。



## 3. 逻辑视图

影院管理系统之中，选择了MVC结构风格，将系统分为模型（Moudle）、视图（View）、控制（Controller）三个部分。视图模块包含了浏览器直接向用户展示的页面部分，模型则包含了各个功能的底层service实现以及每个实现所需要的DAO操作，控制模块则负责处理视图模块的调用模型的服务以及视图选择服务，执行业务逻辑。

但是由于WEB开发的特殊性，一般来讲前端模块不能直接和后端模块进行数据交互，只能通过HTTP请求通过Controller跟后端进行数据交互，因此无法实现“观察者模式”，其实是不完全的MVC。

![MVC](https://s2.ax1x.com/2019/04/11/AH0xZq.png)  



图一  参照体系结构风格的包图表达逻辑视角



![MVC](https://i.loli.net/2019/04/18/5cb8685a4b7c7.png)  

图二  软件体系结构逻辑设计方案  

## 4. 组合包图

### 4.1 开发包图

| 开发（物理）包      | 依赖的其他开发包                                             |
| ------------------- | ------------------------------------------------------------ |
| mainui              | accountui, movieui, scheduleui, disountui, vipui, salesui, vo |
| accountui           | accountblserivice, vo                                        |
| accoutbl            | accountblserivice, accountdatasrevice, po                    |
| accountdata         | databaseutility, po, accountdatasrevice                      |
| accountblserivice   |                                                              |
| accountdataservice  | Web, po                                                      |
| movieui             | movieblserivice, vo                                          |
| moviebl             | movieblserivice, moviedatasrevice, po                        |
| moviedata           | databaseutility, po, moviedatasrevice                        |
| movieblservice      |                                                              |
| moviedataservice    | Web, po                                                      |
| scheduleui          | scheduleblserivice, vo                                       |
| schedulebl          | scheduleblserivice, scheduledatasrevice, po                  |
| scheduledata        | databaseutility, po, scheduledatasrevice                     |
| scheduleblservice   |                                                              |
| scheduledataservice | Web, po                                                      |
| discountui          | discountblserivice, vo                                       |
| discountbl          | discountblserivice, discountdatasrevice, po                  |
| discountdata        | databaseutility, po, discountdatasrevice                     |
| discountblserivice  |                                                              |
| discountdataservice | Web, po                                                      |
| vipui               | vipblserivice, vo                                            |
| vipbl               | vipblserivice, vipdatasrevice, po                            |
| vipdata             | databaseutility, po, vipdatasrevice                          |
| vipblserivice       |                                                              |
| vipdataservice      | Web, po                                                      |
| salesui             | salesblserivice, vo                                          |
| salesbl             | salesblserivice, salesdatasrevice, po                        |
| salesdata           | databaseutility, po, salesdatasrevice                        |
| salesblserivice     |                                                              |
| salesdataservice    | Web, po                                                      |
| vo                  |                                                              |
| po                  |                                                              |
| Web                 |                                                              |
| databaseutility     | JDBC/MyBatis                                                 |

![](https://i.loli.net/2019/04/19/5cb9cd3ae7d65.png)

### 4.2 运行时进程

- 在影院系统中，会有多个客户端进程和一个服务器端进程，其进程图如图所示。结合部署图，客户端进程是在网页上运行，服务器端进程是在服务器端机器上运行
- ![](https://i.loli.net/2019/04/12/5cb051911a02e.png)

### 4.3 物理部署

- 影院系统中，观众和影院都是通过浏览器连接互联网访问web服务器，需要windows系统部署RMIStub构件，由于Java RMI构件属于JDK8.0的一部分，所以在系统JDK环境已经设置好的情况下，不需要再独立部署。
- 

![icon](http://assets.processon.com/chart_image/5ae5be27e4b039625af793c0.png?_=1554259679134)

## 5. 架构设计

- 描述功能分解和如何在不同的层中安排软件模块
  - 描述架构中的对象，包含架构图
  - 描述组件接口信息
    - 包括：语法、前置条件、后置条件

### 5.1 模块职责

### 模块职责

- 模块视图

  本系统基于web应用，只需要在客户端使用浏览器访问浏览器端的服务即可。

  ![11](https://i.loli.net/2019/04/18/5cb86ce456d6c.png)

  

- 各模块职责

|     模块     | 职责                                               |
| :----------: | -------------------------------------------------- |
|   view模块   | 展示界面、用户直接交互                             |
| controller层 | 接收view模块的数据，并且调用相关的服务             |
|   module层   | service的具体实现+数据的持久化，返回数据给view层面 |

- 层之间调用接口

  这里view模块和controll模块通过web 容器自带的session以及cookie以及相应的post request来选择相关的控制逻辑，因此并不需要人为规定接口进行沟通，

|                             接口                             | 服务调用方        | 服务提供方       |
| :----------------------------------------------------------: | ----------------- | ---------------- |
| **accountservice**、**movieservice**、**cardservice**、**layoutservice**、**statisticalservice**、**buyticketservice**、**Promotionsservice** | 服务端control模块 | 服务端module模块 |



借用查询电影信息来说明模块之间的调用，如图所示。view模块和controller模块之间，通过post request的方式，更改访问的URL来实现“一个界面对应着一种controller”。通过session，cookie等等来和controller进行数据的交互。而controller在接收到来自view的请求之后，会跳转到相应的bl类，调用module中提供的各种service来实现用户所需要的功能。

这样，大大降低了每一个模块之间的耦合度，便于开发、测试和维护。

![11](https://i.loli.net/2019/04/19/5cb984fc38b02.png)







### 5.2 用户界面层分解

根据需求，系统存在18个用户界面：登陆界面，注册界面，观众主界面，影院员工主界面，管理员界面，查看电影列表界面，查看电影详情界面，搜索界面，上架电影界面，统计想看人数界面，查看排片信息界面，购买电影票界面，查看会员卡界面，购买会员卡界面，充值会员卡界面，设置排片信息可见时间界面，查看统计数据界面，发布优惠活动界面。界面跳转如图所示。

![](https://i.loli.net/2019/04/14/5cb2edfe880c5.png)

#### 类图

用户界面类如图所示。

![](https://i.loli.net/2019/04/12/5cb0741a897df.png)

#### 职责

如图所示为用户界面层模块的职责

| 模块      | 职责                                  |
| --------- | ------------------------------------- |
| MainFrame | 界面Frame，复制界面的显示和界面的跳转 |



#### 接口规范

用户界面层模块的接口规范如表所示

| MainFrame | 语法         | init(args:String[])         |
| --------- | :----------- | --------------------------- |
|           | **前置条件** | **无**                      |
|           | **后置条件** | **显示Frame以及LoginPanel** |

用户界面层需要的服务接口如表所示

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| blservice.loginservice | 登录界面的业务逻辑接口 |



### 5.3 control模块的分解

```
   control模块包括多个针对界面的业务逻辑处理逻辑。例如，User对象负责处理登陆界面的业务逻辑。control模块的设计如图12所示。
```

![图12](https://s2.ax1x.com/2019/04/20/EC0kBq.png)
									图12 control模块的设计

#### 5.3.1 control模块的职责

module模块职责如表8所示。

**表8 module模块的职责**

|        模块        |                   职责                   |
| :----------------: | :--------------------------------------: |
| accountcontroller  | 负责映射和调用对应与登录注册所需要的服务 |
|  moviecontroller   |      负责映射和调用电影所需要的服务      |
| schedulecontroller |      负责映射和调用排片所需要的服务      |
| discountcontroller |      负责映射和调用优惠所需要的服务      |
|   vipcontroller    |      负责映射和调用会员所需要的服务      |
|  salescontroller   |      负责映射和调用销售所需要的服务      |



#### 5.3.2 control模块接口规范

accountcontroller, moviecontroller, schedulecontroller, discountcontroller, vipcontroller, salescontroller 模块的接口规范如下所示。  

##### accountcontroller

| 映射前端request请求              | 调用后端service              |
| -------------------------------- | ---------------------------- |
| /accountcontroller/login         | accountService.login         |
| /accountcontroller/registAccount | accountService.registAccount |

##### moviecontroller  

| 映射前端request请求                          | 调用后端service                          |
| -------------------------------------------- | ---------------------------------------- |
| /moviecontroller/addMovie                    | MovieService.addMovie                    |
| /moviecontroller/searchOneMovieByIdAndUserId | MovieService.searchOneMovieByIdAndUserId |
| /moviecontroller/searchAllMovie              | MovieService.searchAllMovie              |
| /moviecontroller/likeMovie                   | MovieService.likeMovie                   |
| /moviecontroller/unlikeMovie                 | MovieService.unlikeMovie                 |
| /moviecontroller/getCountOfLikes             | MovieService.getCountOfLikes             |
| /moviecontroller/getMovieByKeywords          | MovieService.getMovieByKeywords          |
| /moviecontroller/getLikeNumsGroupByDate      | MovieService.getLikeNumsGroupByDate      |
| /moviecontroller/showStat                    | MovieService.showStat                    |

##### schedulecontroller  

| 映射前端request请求                      | 调用后端service                      |
| ---------------------------------------- | ------------------------------------ |
| /schedulecontroller/addScheduleByDate    | scheduleService.addScheduleByDate    |
| /schedulecontroller/searchScheduleByDate | scheduleService.searchScheduleByDate |
| /schedulecontroller/searchScheduleByHall | scheduleService.searchScheduleByHall |
| /schedulecontroller/setVisibleTime       | scheduleService.setVisibleTime       |
| /schedulecontroller/delSchedule          | scheduleService.delSchedule          |
| /schedulecontroller/changeSchedule       | scheduleService.changeSchedule       |

##### discountcontroller  

| 映射前端request请求                   | 调用后端service                   |
| ------------------------------------- | --------------------------------- |
| /discountcontroller/addDiscountByDate | discountService.addDiscountByDate |

##### vipcontroller  

| 映射前端request请求           | 调用后端service           |
| ----------------------------- | ------------------------- |
| /vipcontroller/addVip         | vipService.addVip         |
| /vipcontroller/showVipBalance | vipService.showVipBalance |
| /vipcontroller/rechargeVip    | vipService.rechargeVip    |

##### Ticketcontroller  

| 映射前端request请求 | 调用后端service              |
| ------------------- | ---------------------------- |
| /ticket/lockSeat    | TicketService.addTicket      |
| /ticket/buy         | TicketService.completeTicket |
| /ticket/cancel      | TicketService.cancelTicket   |
| /ticket/refund      | TicketService.refund         |


##### RefundController

| 映射前端request请求 | 调用后端service                 |
| ------------------- | ------------------------------- |
| /refund/get         | RefundService.getRefundPolicyVO |
| /refund/set         | RefundService.setRefundPolicy   |
| /refund/set/list    | RefundService.setRefundSchedule |

### 5.4 module模块分解

module层提供了各种服务（比如查看电影信息，注册用户、登录等等）。其中每一个服务都包含了相应的数据库操作。数据持久化采用MySQL为解决方案。
![avatar](https://i.loli.net/2019/04/19/5cb9b53b0e356.png)
![11](https://i.loli.net/2019/04/19/5cb98ea584974.png)

#### 职责

module模块的职责如下表所示

|    模块    | 职责                                               |
| :--------: | -------------------------------------------------- |
| module模块 | 实现逻辑层面的业务逻辑，实现一个个的功能和用例要求 |
|  DAO模块   | 接收view模块的数据，并且调用相关的服务             |

| module模块 |                职责                |
| :--------: | :--------------------------------: |
| accountbl  | 负责实现对应与登录注册所需要的服务 |
|  moviebl   |      负责实现电影所需要的服务      |
| schedulebl |      负责实现排片所需要的服务      |
| discountbl |      负责实现优惠所需要的服务      |
|   vipbl    |      负责实现会员所需要的服务      |
|  salescbl  |      负责实现销售所需要的服务      |

#### 接口规范  

**表9 accountbl 模块的接口规范**

![avatar](https://i.loli.net/2019/04/11/5caf1ff3b3652.png)

**表10 moviebl 模块的接口规范**

![avatar](https://i.loli.net/2019/04/19/5cb9b5b62c688.png)

![avatar](https://i.loli.net/2019/04/19/5cb9b5ec21840.png)

**表11 schedulebl 模块的接口规范**

![avatar](https://i.loli.net/2019/04/19/5cb9b6bead697.png)

**表12 discountbl 模块的接口规范**

![avatar](https://i.loli.net/2019/04/19/5cb9b713614df.png)

**表13 vipbl 模块的接口规范**

![avatar](https://i.loli.net/2019/04/19/5cb9b76472ba3.png)

**表14 salesbl 模块的接口规范**

![avatar](https://i.loli.net/2019/04/19/5cb9b7938cea0.png)







## 6. 信息视角  

### 6.1 数据持久化对象  

· UserPO类包含用户的用户名、密码、会员卡信息、用户类型。  

· MoviePO包含电影的名称、简介、上映日期、导演、演员、海报、历史喜爱人数属性。  

· VIPcardPO包含会员卡id，用户信息，余额属性、VIP卡的类型。  

· MovieLikePO记录标记喜爱的用户、对应电影、日期属性。  

· ScreenInfPO记录上映电影的id，影厅与具体场次，票价，占座信息。  

· ConcessionPO是保存优惠信息的类，包含优惠时间、优惠内容、适用条件。  

· MovieHallPO保存影厅名称、影厅座位。  

· VIPCardType包含该种会员卡类型的名称、购卡金额、打折额度、充值的满减额度。

· RefundPolicy包含退票策略的提前适用时间、退换金额比率、适用场次。

持久化用户对象的定义如下：

```
public class UserPO{
    int id;
    String name;
    String password;
    UserRole role;

    public int getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public String getPassword() {
        return password;
    }

    public UserRole getRole() {
        return role;
    }
```

### 6.2 表的设计：  

1. 用户表（三个角色共用同一个表）
   - 用户ID（主键）  
   - 用户名
   - 密码
   - 角色
2. 会员卡表
   - 会员卡ID（主键1）
   - 用户ID（主键2）
   - 会员卡余额
   - 会员卡类型ID
3. 电影表
   - 电影ID（主键）
   - 电影名字
   - 上映日期
   - 导演
   - 主演
   - 宣传海报
   - ……
   - （参照demo）
   - 喜爱人数（需要参考助教）
4. 喜爱电影列表
   - 电影ID（主键）
   - 想看的用户（主键）
   - 喜爱的日期
5. 上映的电影的列表（排片表）
   - 电影ID
   - 拍片日期（开始和结束）
   - 影厅和具体场次
   - 票价
   - 座位1-座位n
6. 影厅
   - 影厅ID（ID）
   - 影厅名称
   - 上映的电影编号
   - 座位信息
7. 优惠政策表
   - 优惠ID（主键）
   - 优惠时间
   - 优惠政策
   - 享受优惠的用户ID
   - 优惠条件  

8. 退票政策表
   - 提前适用时间分钟数
   - 退换比率
   - 适用场次






















































# 影院软件详细设计描述文档

详细设计描述文档修改历史

| 修改人员 | 日期   | 修改原因       | 版本号 |
| :------: | ------ | -------------- | ------ |
|   康南   | 5月4日 | 整合分配的内容 | 1.0.0  |
|          |        |                |        |

## 1. 引言

### 1.1 编制目的

本报告详细完成对电影院电影管理系统的概要设计，达到指导详细设计与开发的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义       | 备注 |
| -------- | -------------- | ---- |
| CMS      | 电影院管理系统 | ……   |
| ……       | ……             | ……   |

### 1.3 参考资料

1.IEEE标准
2.需求文档0418
3.XXX影院需求规格说明文档

## 2. 产品概述

	XXX影院是一家有着拓展业务需求的电影院。原影院只有售票部分使用软件处理，其他业务都是手工作业，由于影院规模扩大，顾客量大幅增长等原因，这已经不能适应它的业务发展需求。
电影管理系统SEII-LOLOK就是为XXX影院新的业务需求发展要求而开发的，它包括一个数据集中服务器和多个客户端。数据集中服务器将所有的数据存储起来进行维护。用户通过客户端完成日常操作，客户端与数据集中服务器才是实时通信的方式完成数据交换,开发目标是帮助该影院处理日常的重点任务以及更好的服务观众
	其主要功能为：
	帮助影院上架、修改、下架电影，统计电影热度信息，添加、查看、修改排片信息，设置、修改、删除排片信息的观众可见时间，查看统计数据，发布优惠活动。
	帮助观众搜索、查找电影，标记电影为想看，查看电影列表、电影详情，购买电影票，购买、查看、充值会员卡。
	通过电影管理系统SEII-LOLOK的应用，期望为XXX影院提高工作效率、合理安排影片场次、吸引观众并提高满意度、提高销售额和利润。

## 3. 系统结构设计概述

影院管理系统中，选择了三层架构体系结构风格，将系统分为3层：表现层、业务逻辑层、数据访问层，能够很好地展示整个系统结构。表现层主要是指与用户交互的界面，用于接收用户输入的数据和显示处理后用户需要的数据。业务逻辑层包含UI层和DAL层之间的桥梁，实现业务逻辑。与数据库打交道。主要实现对数据的增、删、改、查。将存储在数据库中的数据提交给业务层，同时将业务逻辑层处理的数据保存到数据库。

## 4. 结构视角

###  4.1 业务逻辑层的分解

#### 4.1.1 moviebl模块

##### (1) 模块概述
moviebl模块承担的需求参见需求规格说明文档功能需求以及相关非功能需求。
moviebl模块的职责以及接口参见软件系统结构描述文档表10

##### (2) 整体结构
根据体系结构设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，添加了一些接口。在展示层和业务逻辑层之间，根据SpringBoot的机制，通过URL的访问的方式实现和业务逻辑模块交互。而在业务逻辑层于数据持久层之间，则通过主要通过MovieMapper和MovieLikeMapper两个接口进行交流。为了隔离业务逻辑职责和逻辑控制职责，我们增加了MovieController，这样MovieController会将对电影相关业务的处理委托给sales对象。根据功能的不同，为了提高内聚性，分了两个接口/实现类来实现MovieController所具备的功能：MovieService和MovieLikeService。为了实现其中的个别相关功能，额外分别调用了两个接口来实现相关功能：ScheduleServiceForBl接口和MovieServiceForBl接口，分别用于：查找影片的相关信息和根据ID查找电影。

moviebl模块的设计如图所示：

![moviebl](https://i.loli.net/2019/05/02/5ccaafcd147fa.jpg)

moviebl模块各个类的职责如下表所示：  

| 模块             | 职责                          |
| ---------------- | ----------------------------- |
| MovieController  | 实现movie相关的功能的控制逻辑 |
| MovieServiceImpl | 实现movie相关功能的业务逻辑   |
| MovieLikeService | 实现movie与统计相关的业务逻辑 |

##### (3) 模块内部类的接口规范

![](https://i.loli.net/2019/05/02/5ccad6560d210.png)

![](https://i.loli.net/2019/05/02/5ccad65b7d07e.png)

![](https://i.loli.net/2019/05/02/5ccad6617ae8e.png)

![](https://i.loli.net/2019/05/02/5ccad665210cd.png)

![](https://i.loli.net/2019/05/02/5ccad6681b40f.png)

![](https://i.loli.net/2019/05/02/5ccad66bcd180.png)

![](https://i.loli.net/2019/05/02/5ccad66fe3eee.png)

![](https://i.loli.net/2019/05/02/5ccad6744e52a.png)

![](https://i.loli.net/2019/05/02/5ccad6774ee4c.png)

##### (4) 业务逻辑层的动态模型
下图表明了该系统之中，当管理员用户输入了添加的电影的信息之后，电影模块业务逻辑处理的相关对象之间的协作。
![](https://i.loli.net/2019/05/02/5ccadde0a53cb.png)
下图所表示的状态图描述了Moviebl模块中，他的生存期间的状态序列、引起转移的时间，以及因为转移状态而伴随的动作。随着addMovie方法的调用，系统进入了MovieForm状态；再一次调用MovieServiceImpl的AddMovie方法，系统进入MovieMapper状态；在这个状态下系统调用InsertMovie方法，向底层数据库中插入相关的电影信息，并返回一个ResponceVO，系统进入ResponceVO状态并且显示

![](https://i.loli.net/2019/05/02/5ccae1615b245.png)

##### (5) 业务逻辑层的设计原理
利用委托式控制风格，每一个界面需要访问的业务逻辑由各自的控制器委托给不同的对象

#### 4.1.2 accountbl 模块

##### (1)模块概述

accountbl 模块承担的需求参见规格需求说明文档

accountbl模块的职责及借口参见软件体系结构描述文档

##### (2)整体结构

	根据体系结构设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，添加了一些接口。在展示层和业务逻辑层之间，根据SpringBoot的机制，通过URL的访问的方式实现和业务逻辑模块交互。而在业务逻辑层于数据持久层之间，则通过主要通过AccountMapper接口进行交流。为了隔离业务逻辑职责和逻辑控制职责，我们增加了AccountController，这样AccountController会将对账户相关业务的处理委托给AccountServicempl对象。根据功能的不同，为了提高内聚性，分了一个接口/实现类来实现AccountController所具备的功能：AccountService。

![](https://i.loli.net/2019/05/04/5ccd7ef5cc267.jpg)

| 模块               | 职责                            |
| ------------------ | ------------------------------- |
| AccountController  | 实现Account相关的功能的控制逻辑 |
| AccountServiceImpl | 实现Account相关功能的业务逻辑   |

##### (3)模块内部类的接口规范

表 accountbl模块各个类的职责

![avatar](https://i.loli.net/2019/04/11/5caf1ff3b3652.png)

##### (4)业务逻辑层动态模型

![Account2](https://i.loli.net/2019/05/04/5ccd7f558739d.jpg)

##### (5) 业务逻辑层的设计原理

利用委托式控制风格，每一个界面需要访问的业务逻辑由各自的控制器委托给不同的对象

#### 4.1.3 vipbl模块

##### (1)模块概述

vipbl 模块承担的需求参见规格需求说明文档

vipbl模块的职责及借口参见软件体系结构描述文档

##### (2)整体结构

	根据体系结构设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，添加了一些接口。在展示层和业务逻辑层之间，根据SpringBoot的机制，通过URL的访问的方式实现和业务逻辑模块交互。而在业务逻辑层于数据持久层之间，则通过主要通过VIPCardMapper接口进行交流。为了隔离业务逻辑职责和逻辑控制职责，我们增加了VIPController，这样VIPController会将对会员相关业务的处理委托给VIPCardServicempl对象。根据功能的不同，为了提高内聚性，分了一个接口/实现类来实现VIPCardController所具备的功能：VIPService。

![VIP](https://i.loli.net/2019/05/04/5ccd7f7d893a0.jpg)

| 模块               | 职责                          |
| ------------------ | ----------------------------- |
| VIPController      | 实现VIP相关的功能的控制逻辑   |
| VIPCardServiceImpl | 实现VIPCard相关功能的业务逻辑 |

##### (3)模块内部类的接口规范

![avatar](https://i.loli.net/2019/04/19/5cb9b76472ba3.png)

##### (4)业务逻辑层动态模型

![VIPcard](https://i.loli.net/2019/05/04/5ccd7fa0c6857.jpg)

##### (5) 业务逻辑层的设计原理

利用委托式控制风格，每一个界面需要访问的业务逻辑由各自的控制器委托给不同的对象

#### 4.1.4 salesbl模块

##### (1)模块概述

salebl 模块承担的需求参见规格需求说明文档

salebl模块的职责及借口参见软件体系结构描述文档

##### (2)整体结构

	根据体系结构设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，添加了一些接口。我们使用TicketService完成电影票操作，为了实现退票策略，我们增加了RefundService用于管理退票策略。在展示层和业务逻辑层之间，根据SpringBoot的机制，通过URL的访问的方式实现和业务逻辑模块交互。而在业务逻辑层于数据持久层之间，则通过主要通过TicketMapper、接口进行交流。为了隔离业务逻辑职责和逻辑控制职责，我们增加了TicketController，RefundController这样TicketController、RefundController会将对销售相关业务的处理委托给TicketServicempl,RefundControllermpl对象。

![salebl](作业相关/hyz/salebl.jpg)

| 模块              | 职责                           |
| ----------------- | ------------------------------ |
| TicketController  | 实现Ticket相关的功能的控制逻辑 |
| TicketServiceImpl | 实现Ticket相关功能的业务逻辑   |
| RefundController  | 实现退票策略相关的逻辑控制     |
| RefundServicelmpl | 实现退票策略的业务逻辑         |

##### (3)模块内部类的接口规范

<table>
<tr >
 <td colspan=3 >提供的服务（供接口）</td>
</tr>
<tr >
 <td rowspan=3>TicketController.lockSeats</td>
 <td>语法</td>
 <td>public ResponseVO lockSeat(TicketForm ticketForm)</td>
</tr>
<tr >
 <td >前置条件</td>
 <td>已创建TicketForm，选好座位开始锁定座位</td>
</tr>
<tr >
 <td >后置条件</td>
 <td>调用TicketServicempl.addTicket</td>
</tr>
<tr >
 <td rowspan=3>TicketController.buyTicket</td>
 <td>语法</td>
 <td>public ResponseVO buyTicket(OrderVO order)</td>
</tr>
<tr >
 <td >前置条件</td>
 <td>已锁座开始买票</td>
</tr>
<tr >
 <td >后置条件</td>
 <td>已创建Order,调用TicketServicempl.completeTicket</td>
</tr>
<tr >
 <td rowspan=3>TicketController.getOccupiedSeats</td>
 <td>语法</td>
 <td>public ResponseVO getOccupiedSeats(int scheduleId)</td>
</tr>
<tr >
 <td >前置条件</td>
 <td>开始选座</td>
</tr>
<tr >
 <td >后置条件</td>
 <td>调用TicketServicempl.getBySchedule</td>
</tr>
<tr >
 <td rowspan=3>TicketController.refund</td>
 <td>语法</td>
 <td>public ResponseVO refund(int expenseId)</td>
</tr>
<tr >
 <td >前置条件</td>
 <td>开始退票</td>
</tr>
<tr >
 <td >后置条件</td>
 <td>调用TicketServicempl.Refund</td>
</tr>
<tr >
 <td rowspan=3>TicketController.cancelTicket</td>
 <td>语法</td>
 <td>public ResponseVO cancelTicket(List&lt;Integer&gt; ticketId)</td>
</tr>
<tr >
 <td >前置条件</td>
 <td>用户取消订单</td>
</tr>
<tr >
 <td >后置条件</td>
 <td>调用TicketServicempl.cancelTicket</td>
</tr>
</table>

<table border=0 cellpadding=0 cellspacing=0 width=781 style='border-collapse:
 collapse;table-layout:fixed;width:586pt'>
 <col width=268 style='mso-width-source:userset;mso-width-alt:8576;width:201pt'>
 <col width=121 style='mso-width-source:userset;mso-width-alt:3882;width:91pt'>
 <col width=392 style='mso-width-source:userset;mso-width-alt:12544;width:294pt'>
 <tr height=21 style='height:16.0pt'>
  <td colspan=3 height=21 class=xl65 width=781 style='height:16.0pt;width:586pt'>提供的服务（供接口）</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>TicketService.addTicket</td>
  <td>语法</td>
  <td>public ResponseVO addTicket(TicketForm ticketForm)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>开始锁定座位</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>锁定座位，设置座位为不可选，出票</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>TicketService.completeTicket</td>
  <td>语法</td>
  <td>public ResponseVO completeTicket(OrderVO orderVO)<span
  style='mso-spacerun:yes'> </span></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>已锁座出票但未付款</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>选择支付方式并扣款</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>TicketService.getBySchedule</td>
  <td>语法</td>
  <td>public ResponseVO getBySchedule(int scheduleId）</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>开始某场次的选座</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>返回该场次的座位占位情况</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>TicketService.refund</td>
  <td>语法</td>
  <td>public ResponseVO refund(int expenseId)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>选好需要退款的票时</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>将票标注为已退款，并且根据退票策略退款</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>TicketService.cancelTicket</td>
  <td>语法</td>
  <td>public ResponseVO cancelTicket(List&lt;Integer&gt; ticketId)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>用户取消订单</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>将订单内的票设为已失效</td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=268 style='width:201pt'></td>
  <td width=121 style='width:91pt'></td>
  <td width=392 style='width:294pt'></td>
 </tr>
 <![endif]>
</table>

<table border=0 cellpadding=0 cellspacing=0 width=827 style='border-collapse:
 collapse;table-layout:fixed;width:620pt'>
 <col width=268 style='mso-width-source:userset;mso-width-alt:8576;width:201pt'>
 <col width=95 style='mso-width-source:userset;mso-width-alt:3029;width:71pt'>
 <col width=464 style='mso-width-source:userset;mso-width-alt:14848;width:348pt'>
 <tr height=21 style='height:16.0pt'>
  <td colspan=3 height=21 class=xl65 width=827 style='height:16.0pt;width:620pt'>提供的服务（供接口）</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>RefundController.getRefundPolicy</td>
  <td>语法</td>
  <td>public ResponseVO getRefundPolicy()</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>获取设定好的退票策略</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>调用refundService.getRefundPolicyVO</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>RefundController.setRefundPolicy</td>
  <td>语法</td>
  <td>public ResponseVO setRefundPolicy(RefundPolicy refundPolicy)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>建立对象RefundPolicy,重新设定退票策略</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>调用refundService.setRefundPolicy</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>RefundController.setRefundSchedule</td>
  <td>语法</td>
  <td>public ResponseVO setRefundSchedule(List&lt;Integer&gt; scheduleId)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>设定的使用退票策略的场次</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>调用setRefundSchedule</td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=268 style='width:201pt'></td>
  <td width=95 style='width:71pt'></td>
  <td width=464 style='width:348pt'></td>
 </tr>
 <![endif]>
</table>

<table border=0 cellpadding=0 cellspacing=0 width=827 style='border-collapse:
 collapse;table-layout:fixed;width:620pt'>
 <col width=268 style='mso-width-source:userset;mso-width-alt:8576;width:201pt'>
 <col width=95 style='mso-width-source:userset;mso-width-alt:3029;width:71pt'>
 <col width=464 style='mso-width-source:userset;mso-width-alt:14848;width:348pt'>
 <tr height=21 style='height:16.0pt'>
  <td colspan=3 height=21 class=xl65 width=827 style='height:16.0pt;width:620pt'>提供的服务（供接口）</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>RefundService.getRefundPolicy</td>
  <td>语法</td>
  <td>public ResponseVO getRefundPolicy()</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>获取设定好的退票策略</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>返回设定好的退票策略对象</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>RefundService.setRefundPolicy</td>
  <td>语法</td>
  <td>public ResponseVO setRefundPolicy(RefundPolicy refundPolicy)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>建立对象RefundPolicy,重新设定退票策略</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>储存并更新新设定的退票策略</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td rowspan=3 height=63 class=xl66 style='height:48.0pt'>RefundService.setRefundSchedule</td>
  <td>语法</td>
  <td>public ResponseVO setRefundSchedule(List&lt;Integer&gt; scheduleId)</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>前置条件</td>
  <td>设定的使用退票策略的场次</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 style='height:16.0pt'>后置条件</td>
  <td>设置退票策略适用的场次</td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=268 style='width:201pt'></td>
  <td width=95 style='width:71pt'></td>
  <td width=464 style='width:348pt'></td>
 </tr>
 <![endif]>
</table>

##### (4)业务逻辑层动态模型

![salebl](作业相关/hyz/sale.jpg)
Sales对象状态图

##### (5) 业务逻辑层的设计原理

利用委托式控制风格，每一个界面需要访问的业务逻辑由各自的控制器委托给不同的对象

#### 4.1.5 schedulebl 模块

##### (1)模块描述

schedulebl 模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

schedulebl 模块的职责及接口参见软件系统结构描述文档表10。

##### (2)整体结构

根据体系结构设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，添加了一些接口。在展示层和业务逻辑层之间，根据SpringBoot的机制，通过URL的访问的方式实现和业务逻辑模块交互。而在业务逻辑层于数据持久层之间，则通过主要通过ScheduleMapper接口进行交流。为了隔离业务逻辑职责和逻辑控制职责，我们增加了ScheduleController，这样ScheduleController会将对排片相关业务的处理委托给schedule对象。根据功能的不同，为了提高内聚性，分了两个接口/实现类来实现ScheduleController所具备的功能：ScheduleService。为了实现其中的个别相关功能，额外调用了一个接口来实现相关功能：ScheduleServiceForBl接口，用于：查找排片的相关信息和根据ID查找排片。

schedulebl模块的设计图如图所示：

![schedulebl](https://i.loli.net/2019/05/03/5ccb9547a1aa1.png)

couponbl模块各个类的职责如下表所示：  

| 模块                | 职责                         |
| ------------------- | ---------------------------- |
| ScheduleController  | 实现排片相关的功能的控制逻辑 |
| ScheduleServiceImpl | 实现排片相关功能的业务逻辑   |

##### (3) 模块内部类的接口规范

![](https://i.loli.net/2019/05/03/5ccbaab36b53e.png)
![](https://i.loli.net/2019/05/04/5ccd84ed77a6f.png)
![](https://i.loli.net/2019/05/04/5ccd85082461c.png)
![](https://i.loli.net/2019/05/04/5ccd8529a4889.png)
![](https://i.loli.net/2019/05/04/5ccd8540a52d2.png)

##### (4) 业务逻辑层的动态模型

下图表明了该系统之中，当管理员用户输入了添加的排片的信息之后，排片模块业务逻辑处理的相关对象之间的协作。

![](https://i.loli.net/2019/05/03/5ccbb8b6369ef.png)



下图所表示的状态图描述了Schedulebl模块中，他的生存期间的状态序列、引起转移的时间，以及因为转移状态而伴随的动作。随着addSchedule方法的调用，系统进入了ScheduleForm状态；再一次调用ScheduleServiceImpl的AddSchedule方法，系统进入ScheduleMapper状态；在这个状态下系统调用InsertSchedule3方法，向底层数据库中插入相关的电影信息，并返回一个ResponceVO，系统进入ResponceVO状态并且显示

![](https://i.loli.net/2019/05/03/5ccbac3f119a7.png)

##### (5) 业务逻辑层的设计原理
利用委托式控制风格，每一个界面需要访问的业务逻辑由各自的控制器委托给不同的对象

#### 4.1.6 couponbl 模块

##### (1)模块描述

couponbl 模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

couponbl 模块的职责及接口参见软件系统结构描述文档表10。

##### (2)整体结构

根据体系结构设计，我们将系统分为展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，添加了一些接口。在展示层和业务逻辑层之间，根据SpringBoot的机制，通过URL的访问的方式实现和业务逻辑模块交互。而在业务逻辑层于数据持久层之间，则通过主要通过CouponMapper接口进行交流。为了隔离业务逻辑职责和逻辑控制职责，我们增加了CouponController，这CouponController会将对排片相关业务的处理委托给schedule对象。根据功能的不同，为了提高内聚性，分了两个接口/实现类来实现CouponController所具备的功能：CouponService。为了实现其中的个别相关功能，额外调用了一个接口来实现相关功能：CouponServiceForBl接口，用于：查找排片的相关信息和根据ID查找排片。

couponbl模块的设计图如图所示：

![couponbl](https://i.loli.net/2019/05/03/5ccbbe3cf2cb9.png)

couponbl模块各个类的职责如下表所示：  

| 模块              | 职责                         |
| ----------------- | ---------------------------- |
| CouponController  | 实现优惠相关的功能的控制逻辑 |
| CouponServiceImpl | 实现优惠相关功能的业务逻辑   |

##### (3) 模块内部类的接口规范

![](https://i.loli.net/2019/05/03/5ccbc4f499586.png)

![](https://i.loli.net/2019/05/03/5ccbc514a5e36.png)

##### (4) 业务逻辑层的动态模型

下图所表示的状态图描述了Couponbl模块中，他的生存期间的状态序列、引起转移的时间，以及因为转移状态而伴随的动作。随着addCoupon方法的调用，系统进入了CouponForm状态；再一次调用CouponServiceImpl的AddCoupon方法，系统进入CouponMapper状态；在这个状态下系统调用InsertCoupon方法，向底层数据库中插入相关的优惠信息，并返回一个ResponceVO，系统进入ResponceVO状态并且显示

![](https://i.loli.net/2019/05/03/5ccbc64b27237.png)

##### (5) 业务逻辑层的设计原理
利用委托式控制风格，每一个界面需要访问的业务逻辑由各自的控制器委托给不同的对象

## 5. 依赖视角

![](https://i.loli.net/2019/05/03/5ccbed673dd4a.png)







### 附录  

进程记载<https://github.com/0APPTI0/SEII-LOLOK>  